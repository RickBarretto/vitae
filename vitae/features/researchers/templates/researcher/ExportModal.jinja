{#def fn_name: str #}


<dialog id="export-modal" class="bg-white/70 backdrop-blur rounded-2xl shadow-xl shadow-md p-6 max-w-[90%] w-[800px]">
    <header class="flex items-center border-b border-gray-300 mb-4">
        <h2 class="m-0 text-lg font-semibold">Exportar Pesquisador</h2>
    </header>
    <ui.CodeBlock id="lucy-lattes-csv">Carregando...</ui.CodeBlock>
    <footer class="border-t border-gray-300 mt-4"></footer>
</dialog>

<style>
#export-modal::backdrop {
    backdrop-filter: blur(0.1rem);
    background-color: rgba(0, 0, 0, 0.1);
}
</style>

{# Close modal #}
<script>
(function() {
    const self = document.getElementById('export-modal')

    self.addEventListener('click', (event) => {
        if (event.target === self) self.close()
    })
})()
</script>

{# Open modal with fetched data #}
<script>
async function {{fn_name}}(id) {
    const element = document.querySelector(`[data-researcher-id="${id}"]`)
    if (!element) return

    const endpoint = element.dataset.endpoint
    const action = element.dataset.action

    const lucyModal = document.getElementById('export-modal')
    const codeBlock = document.querySelector('#lucy-lattes-csv code')

    codeBlock.textContent = 'Carregando...'
    lucyModal.showModal()

    try {
        const res = await fetch(`/${endpoint}/${id}/${action}`)
        if (!res.ok) throw new Error(`HTTP ${res.status}`)
        const text = await res.json()
        codeBlock.textContent = text
    } catch (err) {
        codeBlock.textContent = `Error: ${err.message}`
    }
}
</script>